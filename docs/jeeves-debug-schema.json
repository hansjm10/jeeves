{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Jeeves Debug JSONL Event",
  "type": "object",
  "additionalProperties": true,
  "required": [
    "schema",
    "event",
    "ts",
    "runId",
    "mode",
    "runner",
    "phase",
    "seq",
    "event_id"
  ],
  "properties": {
    "schema": {
      "const": "jeeves.debug.v1",
      "description": "Debug event schema version."
    },
    "event": {
      "type": "string",
      "enum": [
        "debug_run_start",
        "debug_run_end",
        "debug_iteration_start",
        "debug_iteration_end",
        "debug_runner_invoke",
        "debug_log_line",
        "debug_sdk_tool_use",
        "debug_sdk_message"
      ],
      "description": "Event type."
    },
    "ts": {
      "type": "string",
      "description": "UTC timestamp when the event was emitted."
    },
    "runId": {
      "type": "string",
      "description": "Run identifier (also used in per-run directory name)."
    },
    "mode": {
      "type": "string",
      "enum": [
        "issue",
        "prd"
      ]
    },
    "runner": {
      "type": "string",
      "description": "Runner used for the iteration (codex|claude|opencode|sdk)."
    },
    "workDir": {
      "type": "string"
    },
    "stateDir": {
      "type": "string"
    },
    "phase": {
      "type": "string",
      "description": "Phase at the start of the iteration."
    },
    "iteration": {
      "type": [
        "integer",
        "null"
      ]
    },
    "seq": {
      "type": "integer",
      "minimum": 1,
      "description": "Monotonic sequence number for this run."
    },
    "event_id": {
      "type": "string",
      "description": "Stable event id in the form <runId>:<seq>."
    },
    "outputMode": {
      "type": [
        "string",
        "null"
      ],
      "enum": [
        "stream",
        "compact",
        null
      ]
    },
    "maxIterations": {
      "type": [
        "integer",
        "null"
      ]
    },
    "debugTrace": {
      "type": [
        "string",
        "null"
      ],
      "enum": [
        "full",
        "summary",
        null
      ]
    },
    "prompt": {
      "type": "object",
      "properties": {
        "template": {
          "type": [
            "string",
            "null"
          ]
        },
        "effective": {
          "type": [
            "string",
            "null"
          ]
        },
        "appendFile": {
          "type": [
            "string",
            "null"
          ]
        },
        "bytes": {
          "type": [
            "integer",
            "null"
          ]
        },
        "appendBytes": {
          "type": [
            "integer",
            "null"
          ]
        }
      }
    },
    "runnerStats": {
      "type": "object",
      "properties": {
        "calls": {
          "type": [
            "integer",
            "null"
          ]
        },
        "logBytes": {
          "type": [
            "integer",
            "null"
          ]
        },
        "logLines": {
          "type": [
            "integer",
            "null"
          ]
        },
        "lastMessageBytes": {
          "type": [
            "integer",
            "null"
          ]
        },
        "execCount": {
          "type": [
            "integer",
            "null"
          ]
        },
        "fileUpdateCount": {
          "type": [
            "integer",
            "null"
          ]
        }
      }
    },
    "attempt": {
      "type": [
        "integer",
        "null"
      ]
    },
    "line_no": {
      "type": [
        "integer",
        "null"
      ]
    },
    "kind": {
      "type": [
        "string",
        "null"
      ],
      "enum": [
        "exec",
        "file_update",
        "warn",
        "error",
        "other",
        null
      ]
    },
    "raw": {
      "type": [
        "string",
        "null"
      ]
    },
    "completed": {
      "type": [
        "boolean",
        "null"
      ]
    },
    "completionReason": {
      "type": [
        "string",
        "null"
      ]
    },
    "reason": {
      "type": [
        "string",
        "null"
      ]
    },
    "exitCode": {
      "type": [
        "integer",
        "null"
      ]
    },
    "duration_s": {
      "type": [
        "integer",
        "null"
      ]
    },
    "sdk": {
      "type": ["object", "null"],
      "description": "SDK-specific data (present when runner=sdk).",
      "properties": {
        "sessionId": {
          "type": ["string", "null"],
          "description": "SDK session identifier."
        },
        "messageType": {
          "type": ["string", "null"],
          "enum": ["system", "user", "assistant", "tool_result", "result", null],
          "description": "Type of SDK message."
        },
        "toolName": {
          "type": ["string", "null"],
          "description": "Tool name for tool_use events."
        },
        "toolUseId": {
          "type": ["string", "null"],
          "description": "Unique identifier for tool call."
        },
        "toolInput": {
          "type": ["object", "null"],
          "description": "Tool input parameters."
        },
        "toolDurationMs": {
          "type": ["integer", "null"],
          "description": "Tool execution duration in milliseconds."
        },
        "isError": {
          "type": ["boolean", "null"],
          "description": "Whether the tool call resulted in an error."
        },
        "messageCount": {
          "type": ["integer", "null"],
          "description": "Total number of messages at this point."
        },
        "toolCallCount": {
          "type": ["integer", "null"],
          "description": "Total number of tool calls at this point."
        }
      }
    }
  }
}
